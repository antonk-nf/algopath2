# Docker Compose override for development
version: '3.8'

services:
  # Development API service
  api:
    build:
      target: development
    environment:
      - ENVIRONMENT=development
      - LOG_LEVEL=DEBUG
      - LOG_FORMAT=standard
      - DATABASE_ENABLED=false
      - API_WORKERS=1
    volumes:
      # Mount source code for hot reload
      - ./src:/app/src
      - ./tests:/app/tests
      - ./.env:/app/.env
    command: >
      sh -c "python -m uvicorn src.api.app:app 
             --host 0.0.0.0 
             --port 8000 
             --reload 
             --log-level debug"
    # Remove resource limits for development
    deploy:
      resources:
        limits:
          memory: 4G
          cpus: '2.0'

  # Disable database for development by default
  postgres:
    profiles:
      - with-db

  # Disable nginx for development
  nginx:
    profiles:
      - with-nginx

  # Disable redis for development
  redis:
    profiles:
      - with-redis